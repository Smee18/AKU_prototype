FROM node:18-alpine

WORKDIR /app

# Copy package + lock files first for better caching
COPY frontend/package.json frontend/package-lock.json ./

# Install exact dependencies from lockfile
RUN npm ci

# Install ngrok for tunnels (local project dependency)
RUN npm install @expo/ngrok@^4.1.0

# Copy the rest of the frontend files
COPY frontend/ .

# Expo ports + ngrok port
EXPOSE 19000 19001 19002 4040

# Use the local expo CLI from node_modules
CMD ["npx", "expo", "start", "--tunnel"]
