services:
  backend:
    build:
      context: .
      dockerfile: backend/Dockerfile
    ports:
      - "8000:8000"
    volumes:
      - ./data:/data
      - ./backend:/app
    environment:
      - PORT=8000
    restart: unless-stopped

  frontend:
    build:
      context: .
      dockerfile: frontend/Dockerfile
      
    ports:
      - "19000:19000"  # Expo dev server
      - "19001:19001"  # Expo dev tools
      - "19002:19002"  # React Native debugger
      - "4040:4040"    # ngrok web interface
      - "8081:8081"
    environment:
      - EXPO_DEVTOOLS_LISTEN_ADDRESS=0.0.0.0
      - REACT_NATIVE_PACKAGER_HOSTNAME=172.17.15.242
      - CHOKIDAR_USEPOLLING=true
      - WATCHPACK_POLLING=true
    volumes:
      - ./frontend/src:/app/src          # Only mount source files
      - node_modules:/app/node_modules    # Keep node_modules between runs
      - metro-cache:/app/node_modules/.cache
      - expo-cache:/app/.expo
    stdin_open: true
    tty: true

volumes:
  node_modules:
  metro-cache:
  expo-cache:
